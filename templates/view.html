{% extends "base.html" %}
{% block title %}ì „ì²´ ì¡°íšŒ - ê³µê³¼ê¸ˆ ì •ì‚° ì‹œìŠ¤í…œ{% endblock %}
{% block content %}
<h1>ğŸ“Š ì „ì²´ ì¡°íšŒ</h1>

<div class="tabs">
  <button class="tab active" onclick="showTab('tab-electric', event)">ì „ê¸°</button>
  <button class="tab" onclick="showTab('tab-water', event)">ìˆ˜ë„</button>
  <button class="tab" onclick="showTab('tab-common', event)">ê³µë™ ê³µê³¼ê¸ˆ</button>
</div>

<div id="tab-electric" class="tab-content">
  <h2>âš¡ ì „ê¸°ìš”ê¸ˆ</h2>
  <div id="electricList"></div>
</div>

<div id="tab-water" class="tab-content" style="display:none;">
  <h2>ğŸ’§ ìˆ˜ë„ìš”ê¸ˆ</h2>
  <div id="waterList"></div>
</div>

<div id="tab-common" class="tab-content" style="display:none;">
  <h2>ğŸ˜ï¸ ê³µë™ ê³µê³¼ê¸ˆ</h2>
  <div id="commonList"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showTab(id, ev){
  document.querySelectorAll('.tab-content').forEach(x=>x.style.display='none');
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  document.getElementById(id).style.display='block';
  if(ev && ev.target) ev.target.classList.add('active');
}

const electricBills = {{ (electric_bills_json|default([]))|tojson }};
const waterBills = {{ (water_bills_json|default([]))|tojson }};
const commonBills = {{ (common_bills_json|default([]))|tojson }};

function renderElectric(){
  const el = document.getElementById('electricList');
  if(!electricBills.length){ el.innerHTML = '<p style="color:#94a3b8;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
  el.innerHTML = '<table><thead><tr><th>ì›”</th><th>ì¸µ</th><th>ì´ì•¡</th><th>ë³µì§€</th><th>ë°”ìš°ì²˜</th><th>TV</th></tr></thead><tbody>' +
    electricBills.map(b=>`<tr>
      <td>${b.billing_month.slice(0,7)}</td>
      <td>${b.floor_name || ''}</td>
      <td style="text-align:right">${Number(b.total_amount).toLocaleString()}</td>
      <td style="text-align:right">${Number(b.welfare_discount||0).toLocaleString()}</td>
      <td style="text-align:right">${Number(b.voucher_discount||0).toLocaleString()}</td>
      <td style="text-align:right">${Number(b.tv_fee_total||0).toLocaleString()}</td>
    </tr>`).join('') + '</tbody></table>';
}
function renderWater(){
  const el = document.getElementById('waterList');
  if(!waterBills.length){ el.innerHTML = '<p style="color:#94a3b8;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
  el.innerHTML = '<table><thead><tr><th>ì›”</th><th>ì´ì•¡</th><th>ë³µì§€í•©ê³„</th></tr></thead><tbody>' +
    waterBills.map(b=>`<tr>
      <td>${b.billing_month.slice(0,7)}</td>
      <td style="text-align:right">${Number(b.total_amount).toLocaleString()}</td>
      <td style="text-align:right">${Number(b.welfare_discount_total||0).toLocaleString()}</td>
    </tr>`).join('') + '</tbody></table>';
}
function renderCommon(){
  const el = document.getElementById('commonList');
  if(!commonBills.length){ el.innerHTML = '<p style="color:#94a3b8;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
  el.innerHTML = '<table><thead><tr><th>ì›”</th><th>ì„¤ëª…</th><th>ì´ì•¡</th><th>ë¶„ë°° ë°©ì‹</th></tr></thead><tbody>' +
    commonBills.map(b=>`<tr>
      <td>${b.billing_month.slice(0,7)}</td>
      <td>${b.description||''}</td>
      <td style="text-align:right">${Number(b.total_amount).toLocaleString()}</td>
      <td>${b.distribution_method}</td>
    </tr>`).join('') + '</tbody></table>';
}

renderElectric(); renderWater(); renderCommon();
</script>
{% endblock %}
