<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Í≥µÍ≥ºÍ∏à Ï†ïÏÇ∞ ÏãúÏä§ÌÖú{% endblock %}</title>
    <style>
        /* ============================================
           üé® Design System Variables
           ============================================ */
        :root {
            /* Colors - Primary */
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-color: #667eea;
            --primary-dark: #764ba2;

            /* Colors - Neutral */
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;

            /* Colors - Semantic */
            --success-color: #10b981;
            --success-dark: #059669;
            --danger-color: #ef4444;
            --danger-dark: #dc2626;
            --warning-color: #f59e0b;
            --info-color: #0284c7;
            --info-bg: #e0f2fe;
            --info-dark: #0c4a6e;

            /* Typography */
            --font-base: 14px;
            --font-small: 13px;
            --font-xs: 12px;
            --font-large: 18px;
            --font-xlarge: 22px;
            --font-2xl: 28px;

            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 12px;
            --space-lg: 16px;
            --space-xl: 20px;
            --space-2xl: 30px;

            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 15px;
            --radius-2xl: 20px;
            --radius-full: 50%;

            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.1);

            /* Transitions */
            --transition-fast: 0.2s ease;
            --transition-base: 0.3s ease;
        }

        /* ============================================
           üéØ Base Styles
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            font-size: var(--font-base);
            color: var(--gray-800);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-xl);
        }

        /* ============================================
           üß≠ Navigation
           ============================================ */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-xl);
            padding: 15px 30px;
            margin-bottom: var(--space-2xl);
            box-shadow: var(--shadow-lg);
        }

        .navbar ul {
            list-style: none;
            display: flex;
            gap: var(--space-2xl);
            align-items: center;
        }

        .navbar a {
            text-decoration: none;
            color: var(--gray-700);
            font-weight: 500;
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-md);
            transition: var(--transition-base);
        }

        .navbar a:hover, .navbar a.active {
            background: var(--primary-gradient);
            color: white;
        }

        /* ============================================
           üì¶ Content Card
           ============================================ */
        .content-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-2xl);
            padding: var(--space-2xl);
            box-shadow: var(--shadow-lg);
        }

        /* ============================================
           üìù Typography
           ============================================ */
        h1, h2, h3 {
            color: var(--gray-800);
            margin-bottom: var(--space-xl);
            font-weight: 700;
        }

        h1 {
            font-size: 2rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h1 .emoji {
            color: revert;
            color: initial;
            -webkit-text-fill-color: initial;
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
        }

        h2 {
            font-size: var(--font-xlarge);
            color: var(--gray-700);
        }

        h3 {
            font-size: var(--font-large);
            color: var(--gray-700);
        }

        /* ============================================
           üîò Buttons - Unified System
           ============================================ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-base);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-base);
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: var(--danger-dark);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: var(--success-dark);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: var(--font-small);
        }

        /* ============================================
           üìä Tables - Unified System
           ============================================ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: var(--space-xl) 0;
            background: white;
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        th {
            background: var(--gray-100) !important;
            padding: var(--space-md);
            text-align: left;
            font-weight: 600;
            color: var(--gray-700) !important;
            border-bottom: 2px solid var(--gray-300) !important;
            white-space: nowrap;
        }

        th.text-right {
            text-align: right !important;
        }

        td {
            padding: var(--space-md);
            border-bottom: 1px solid var(--gray-200);
        }

        td.text-right {
            text-align: right !important;
            font-weight: 500;
        }

        tr:hover {
            background: var(--gray-50) !important;
            transition: var(--transition-fast);
        }

        /* Í∏àÏï° Ïä§ÌÉÄÏùºÎßÅ */
        .amount-positive {
            color: var(--success-dark);
            font-weight: 500;
        }

        .amount-negative {
            color: var(--danger-dark);
            font-weight: 500;
        }

        /* ÏûëÏóÖ Î≤ÑÌäº */
        .action-buttons {
            white-space: nowrap;
            display: flex;
            gap: var(--space-xs);
        }

        /* ============================================
           üìã Forms - Unified System
           ============================================ */
        .form-group {
            margin-bottom: var(--space-xl);
        }

        label {
            display: block;
            margin-bottom: var(--space-sm);
            font-weight: 500;
            color: var(--gray-700);
        }

        input[type="text"],
        input[type="number"],
        input[type="month"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            font-size: var(--font-base);
            transition: var(--transition-base);
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* ============================================
           üè∑Ô∏è Badges - Unified System
           ============================================ */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: var(--space-xs) 10px;
            font-size: var(--font-xs);
            font-weight: 600;
            white-space: nowrap;
            border-radius: var(--radius-sm);
        }

        .badge-primary {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-info {
            background: var(--info-bg);
            color: var(--info-dark);
        }

        /* ============================================
           üìë Tabs - Unified System
           ============================================ */
        .tabs {
            display: flex;
            gap: var(--space-sm);
            margin-bottom: var(--space-xl);
            border-bottom: 2px solid var(--gray-200);
        }

        .tab {
            padding: var(--space-md) var(--space-xl);
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray-600);
            border-bottom: 3px solid transparent;
            transition: var(--transition-base);
            font-size: var(--font-base);
        }

        .tab:hover {
            color: var(--primary-color);
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tabs-container > .tab-content {
            display: none;
        }

        .tabs-container > .tab-content:first-child {
            display: block;
        }

        /* ============================================
           üí¨ Alerts & Messages
           ============================================ */
        .alert {
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-xl);
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid var(--success-color);
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--danger-color);
        }

        .alert-info {
            background: var(--info-bg);
            color: var(--info-dark);
            border-left: 4px solid var(--info-color);
        }

        /* ============================================
           ü™ü Modal System
           ============================================ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-2xl);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        .modal-content h2 {
            margin-top: 0;
            margin-bottom: var(--space-xl);
            color: var(--gray-800);
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Î™®Îã¨ Î∞∞Í≤Ω ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞ */
        .modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* ============================================
           üì± Responsive Design
           ============================================ */
        @media (max-width: 768px) {
            .container {
                padding: var(--space-md);
            }

            .navbar ul {
                flex-direction: column;
                gap: var(--space-sm);
            }

            table {
                font-size: var(--font-small);
            }

            th, td {
                padding: var(--space-sm);
            }
        }

        /* ============================================
           üìê Grid Layouts
           ============================================ */
        .grid {
            display: grid;
            gap: var(--space-xl);
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        /* ============================================
           üìä Stat Cards
           ============================================ */
        .stat-card {
            background: var(--primary-gradient);
            color: white;
            padding: var(--space-xl);
            border-radius: var(--radius-xl);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: var(--transition-base);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .stat-card h3 {
            color: white;
            font-size: 1rem;
            margin-bottom: 10px;
            opacity: 0.9;
            font-weight: 500;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: white;
        }

        /* ============================================
           üì± Responsive Grid
           ============================================ */
        @media (max-width: 768px) {
            .grid-2,
            .grid-3,
            .grid-4 {
                grid-template-columns: 1fr;
            }
        }

        /* ============================================
           üé® Utility Classes
           ============================================ */
        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-left {
            text-align: left;
        }

        .mt-1 {
            margin-top: var(--space-sm);
        }

        .mt-2 {
            margin-top: var(--space-md);
        }

        .mt-3 {
            margin-top: var(--space-xl);
        }

        .mb-1 {
            margin-bottom: var(--space-sm);
        }

        .mb-2 {
            margin-bottom: var(--space-md);
        }

        .mb-3 {
            margin-bottom: var(--space-xl);
        }

        .p-1 {
            padding: var(--space-sm);
        }

        .p-2 {
            padding: var(--space-md);
        }

        .p-3 {
            padding: var(--space-xl);
        }

        .font-bold {
            font-weight: 600;
        }

        .font-semibold {
            font-weight: 500;
        }

        .text-sm {
            font-size: var(--font-small);
        }

        .text-xs {
            font-size: var(--font-xs);
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .navbar ul {
                flex-wrap: wrap;
                gap: 10px;
            }

            .content-card {
                padding: 20px;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 8px;
            }
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
{#------------------------------------------------GNB------------------------------------------------#}
<body>
<div class="container">
    <nav class="navbar">
        <ul>
            <li><a href="{{ url_for('index') }}" class="{% if request.endpoint == 'index' %}active{% endif %}">üè† Ìôà</a>
            </li>
            <li><a href="{{ url_for('settings') }}" class="{% if request.endpoint == 'settings' %}active{% endif %}">‚öôÔ∏è
                ÏÑ§Ï†ï</a></li>
            <li><a href="{{ url_for('calculator') }}"
                   class="{% if request.endpoint == 'calculator' %}active{% endif %}">üßÆ Í≥ÑÏÇ∞Í∏∞</a></li>
            <li><a href="{{ url_for('view_bills') }}"
                   class="{% if request.endpoint == 'view_bills' %}active{% endif %}">üìä Ï°∞Ìöå</a></li>
            <li><a href="{{ url_for('invoice_combination') }}"
                   class="{% if request.endpoint == 'invoice_combination' %}active{% endif %}">üìÑ Ï†ïÏÇ∞</a></li>
            <li><a href="{{ url_for('payments') }}" class="{% if request.endpoint == 'payments' %}active{% endif %}">üí≥
                ÎÇ©Î∂Ä ÎÇ¥Ïó≠</a></li>
        </ul>
    </nav>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    {#------------------------------------------------GNB ENDS HERE----------------------------------------#}
    <div class="content-card">
        {% block content %}{% endblock %}
    </div>
</div>

<!-- Î™®Îã¨ ÏòÅÏó≠ (body ÏßÅÍ≥Ñ ÏûêÏãù, container Ïô∏Î∂Ä) -->
{% block modals %}{% endblock %}

<script>
    // CSRF ÌÜ†ÌÅ∞ Ï≤òÎ¶¨
    function getCsrfToken() {
        return '{{ csrf_token() }}';
    }

    // Î™®Îã¨ Í¥ÄÎ†® Ìï®Ïàò
    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('active');
        } else {
            console.error('Modal not found:', modalId);
        }
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
        }
    }

    // Î™®Îã¨ Î∞∞Í≤Ω ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal')) {
            closeModal(e.target.id);
        }
    });

    // Ïà´Ïûê Ìè¨Îß∑ÌåÖ
    function formatNumber(num) {
        return new Intl.NumberFormat('ko-KR').format(num);
    }

    // Ajax ÏöîÏ≤≠ Ìó¨Ìçº
    async function fetchAPI(url, method = 'GET', data = null) {
        const options = {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            }
        };

        if (method === 'POST' && data) {
            if (data instanceof FormData) {
                options.body = data;
                delete options.headers['Content-Type'];
            } else {
                options.body = JSON.stringify(data);
            }
        }

        const response = await fetch(url, options);
        return response.json();
    }
</script>
{% block scripts %}{% endblock %}
</body>
</html>