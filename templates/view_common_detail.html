{% extends "base.html" %}
{% block title %}ê³µë™ ê³µê³¼ê¸ˆ ìƒì„¸ - ê³µê³¼ê¸ˆ ì •ì‚° ì‹œìŠ¤í…œ{% endblock %}
{% block content %}
    <h1><span class="emoji">ğŸ˜ï¸</span> ê³µë™ ê³µê³¼ê¸ˆ ìƒì„¸ ë‚´ì—­</h1>

<div style="display:flex; justify-content:space-between; margin-bottom:20px;">
  <div>
    <h2>{{ bill.billing_month.strftime('%Yë…„ %mì›”') }} - {{ bill.description|default('ê³µë™ ê³µê³¼ê¸ˆ') }}</h2>
    <p style="color:#64748b;">
      ë¶„ë°° ë°©ì‹: {% if bill.distribution_method == 'BY_RESIDENTS' %}ì¸ì›ìˆ˜ ë¹„ë¡€{% else %}ì„¸ëŒ€ ê· ë“±{% endif %}
    </p>
  </div>
  <a href="{{ url_for('view_bills') }}" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ</a>
</div>

<div class="grid grid-2" style="margin-bottom:30px;">
  <div style="background:#f8fafc; padding:20px; border-radius:12px;">
    <h3>ì²­êµ¬ ì •ë³´</h3>
    <table style="width:100%;">
      <tr><td>í•­ëª©:</td><td style="text-align:right"><strong>{{ bill.description|default('ê³µë™ ê³µê³¼ê¸ˆ') }}</strong></td></tr>
      <tr><td>ì´ì•¡:</td><td style="text-align:right"><strong>{{ "{:,.0f}".format(bill.total_amount) }}ì›</strong></td></tr>
      <tr><td>ë¶„ë°° ë°©ì‹:</td><td style="text-align:right">
        {% if bill.distribution_method == 'BY_RESIDENTS' %}
          ì¸ì›ìˆ˜ ë¹„ë¡€
        {% else %}
          ì„¸ëŒ€ ê· ë“±
        {% endif %}
      </td></tr>
    </table>
  </div>
  <div style="background:#f8fafc; padding:20px; border-radius:12px;">
    <h3>ì •ì‚° ìš”ì•½</h3>
    <table style="width:100%;">
      <tr><td>ì •ì‚° ì„¸ëŒ€ìˆ˜:</td><td style="text-align:right"><strong>{{ details|length }}ì„¸ëŒ€</strong></td></tr>
      {% if bill.distribution_method == 'BY_RESIDENTS' %}
      <tr><td>ì´ ê±°ì£¼ ì¸ì›:</td><td style="text-align:right">{{ details|sum(attribute='unit_snapshot.residents_count') }}ëª…</td></tr>
      {% endif %}
      <tr><td>ì„¸ëŒ€ë³„ í‰ê· :</td><td style="text-align:right">{{ "{:,.0f}".format((details|sum(attribute='charged_amount')) / (details|length) if details else 0) }}ì›</td></tr>
      <tr><td>ìµœì¢… ì²­êµ¬ ì´ì•¡:</td><td style="text-align:right"><strong>{{ "{:,.0f}".format(details|sum(attribute='charged_amount')) }}ì›</strong></td></tr>
    </table>
  </div>
</div>

<h3>ì„¸ëŒ€ë³„ ìƒì„¸ ë‚´ì—­</h3>
<table>
  <thead>
    <tr style="background:#e2e8f0;">
      <th>ì„¸ëŒ€</th>
      {% if bill.distribution_method == 'BY_RESIDENTS' %}
      <th>ê±°ì£¼ ì¸ì›</th>
      {% endif %}
      <th>ë°°ë¶„ì•¡</th>
      <th style="background:#fef3c7;">ì²­êµ¬ ê¸ˆì•¡<br>(10ì› ë‹¨ìœ„)</th>
    </tr>
  </thead>
  <tbody>
    {% for detail in details %}
    <tr>
      <td><strong>{{ detail.unit.unit_name }}</strong></td>
      {% if bill.distribution_method == 'BY_RESIDENTS' %}
      <td style="text-align:center">{{ detail.unit_snapshot.residents_count }}ëª…</td>
      {% endif %}
      <td style="text-align:right">{{ "{:,.0f}".format(detail.amount) }}ì›</td>
      <td style="text-align:right; background:#fef3c7; font-weight:bold; font-size:1.1em;">
        {{ "{:,.0f}".format(detail.charged_amount) }}ì›
      </td>
    </tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr style="background:#e2e8f0; font-weight:bold;">
      <td>í•©ê³„</td>
      {% if bill.distribution_method == 'BY_RESIDENTS' %}
      <td style="text-align:center">{{ details|sum(attribute='unit_snapshot.residents_count') }}ëª…</td>
      {% endif %}
      <td style="text-align:right">{{ "{:,.0f}".format(details|sum(attribute='amount')) }}ì›</td>
      <td style="text-align:right; background:#fbbf24; font-size:1.2em;">
        {{ "{:,.0f}".format(details|sum(attribute='charged_amount')) }}ì›
      </td>
    </tr>
  </tfoot>
</table>

<div style="margin-top:30px; padding:20px; background:#dbeafe; border-radius:12px;">
  <p style="color:#1e40af;">
    ğŸ’¡ <strong>ê³„ì‚° ë°©ì‹ ì•ˆë‚´</strong><br>
    {% if bill.distribution_method == 'BY_RESIDENTS' %}
    â€¢ ë°°ë¶„ì•¡ = (ì„¸ëŒ€ ê±°ì£¼ì¸ì› Ã· ì´ ê±°ì£¼ì¸ì›) Ã— ì´ì•¡<br>
    {% else %}
    â€¢ ë°°ë¶„ì•¡ = ì´ì•¡ Ã· ì •ì‚° ì„¸ëŒ€ìˆ˜<br>
    {% endif %}
    â€¢ ì²­êµ¬ ê¸ˆì•¡ = ë°°ë¶„ì•¡ì„ 10ì› ë‹¨ìœ„ë¡œ ì˜¬ë¦¼ ì²˜ë¦¬
  </p>
</div>

{% endblock %}